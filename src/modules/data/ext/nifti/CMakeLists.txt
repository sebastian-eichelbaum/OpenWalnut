## This file is somehow copy and pasted as well as edited from the original file from niftilib src-package
#PROJECT(NIFTILIB)

MESSAGE( STATUS "Inlcuded NIfTI lib building information." )

OPTION ( NIFTI_BUILD_SHARED_LIBS "Toggle building shared libraries for NIfTI" OFF )

FIND_PACKAGE( ZLIB )

# this now works on win if we specify the zlib directory
IF( ZLIB_FOUND )
    ADD_DEFINITIONS( -DHAVE_ZLIB )
    INCLUDE_DIRECTORIES( ${OPENSCENEGRAPH_INCLUDE_DIRS} ${ZLIB_INCLUDE_DIR} )
ENDIF( ZLIB_FOUND )

SET(ZNZLIB_SRC znzlib.c znzlib.h)
SET(NIFTI_ZNZLIB_NAME ${OWExtNiftiZNZName})
ADD_LIBRARY(${NIFTI_ZNZLIB_NAME} ${ZNZLIB_SRC} )
TARGET_LINK_LIBRARIES( ${NIFTI_ZNZLIB_NAME} ${NIFTI_ZLIB_LIBRARIES} )

# Zlib support currently not on Visual Studio
IF( ZLIB_FOUND )
    TARGET_LINK_LIBRARIES(  ${NIFTI_ZNZLIB_NAME} ${ZLIB_LIBRARY} )
ENDIF( ZLIB_FOUND )

# Set library version when building shared libs.
IF( NIFTI_BUILD_SHARED_LIBS)
  SET(CPACK_PACKAGE_VERSION_MAJOR "1")
  SET(CPACK_PACKAGE_VERSION_MINOR "1")
  SET(CPACK_PACKAGE_VERSION_PATCH "0")
  SET(NIFTI_SHAREDLIB_VERSION ${CPACK_PACKAGE_VERSION_MAJOR}.${CPACK_PACKAGE_VERSION_MINOR}.${CPACK_PACKAGE_VERSION_PATCH} )
  STRING( REGEX MATCH "^[0-9]+" NIFTI_SHAREDLIB_SOVERSION ${NIFTI_SHAREDLIB_VERSION})
  SET(NIFTI_LIBRARY_PROPERTIES VERSION ${NIFTI_SHAREDLIB_VERSION} SOVERSION ${NIFTI_SHAREDLIB_SOVERSION})
  SET_TARGET_PROPERTIES(${NIFTI_NIFTILIB_NAME} PROPERTIES ${NIFTI_LIBRARY_PROPERTIES})
  SET_TARGET_PROPERTIES(${NIFTI_ZNZLIB_NAME} PROPERTIES ${NIFTI_LIBRARY_PROPERTIES})
ENDIF( NIFTI_BUILD_SHARED_LIBS)


SET(NIFTILIB_SRC nifti1_io.c nifti1_io.h nifti1.h)
SET(NIFTI_NIFTILIB_NAME ${OWExtNiftiIOName})
ADD_LIBRARY(${NIFTI_NIFTILIB_NAME} ${NIFTILIB_SRC} )
TARGET_LINK_LIBRARIES( ${NIFTI_NIFTILIB_NAME} ${NIFTI_ZNZLIB_NAME})

IF(MSVC_IDE)
    SET_TARGET_PROPERTIES( ${NIFTI_NIFTILIB_NAME} PROPERTIES PREFIX "../")
ENDIF(MSVC_IDE)

IF(UNIX)
  TARGET_LINK_LIBRARIES(${NIFTI_NIFTILIB_NAME} -lm)
ENDIF(UNIX)

# Set the version of the library.
SET_TARGET_PROPERTIES( ${NIFTI_ZNZLIB_NAME} PROPERTIES
        VERSION ${OW_LIB_VERSION} 
        SOVERSION ${OW_SOVERSION}
)
# Set the version of the library.
SET_TARGET_PROPERTIES( ${NIFTI_NIFTILIB_NAME} PROPERTIES
        VERSION ${OW_LIB_VERSION} 
        SOVERSION ${OW_SOVERSION}
)

# install target
INSTALL( TARGETS ${NIFTI_NIFTILIB_NAME} ${NIFTI_ZNZLIB_NAME}
            ARCHIVE # NOTE: this is needed on windows
                DESTINATION ${OW_LIBRARY_DIR_RELATIVE}
                PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE
                            GROUP_READ GROUP_EXECUTE
                            WORLD_READ WORLD_EXECUTE
            LIBRARY # NOTE: this is needed for all the others
                DESTINATION ${OW_LIBRARY_DIR_RELATIVE}
                PERMISSIONS OWNER_READ OWNER_WRITE OWNER_EXECUTE
                            GROUP_READ GROUP_EXECUTE
                            WORLD_READ WORLD_EXECUTE
                NAMELINK_SKIP
         COMPONENT "EXT"
)
